{% extends 'blog/base.html' %}

{% block title %}{{ post.title }} - æˆ‘çš„åšå®¢{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-18 mx-auto">
        <!-- è¿”å›æŒ‰é’® -->
        <div class="mb-3">
            <a href="{% url 'blog:post_list' %}" class="btn btn-outline-secondary">
                â† è¿”å›æ–‡ç« åˆ—è¡¨
            </a>
        </div>

        <!-- æ–‡ç« å†…å®¹ -->
        <article class="card">
            <div class="card-body">
                <h1 class="card-title mb-3">{{ post.title }}</h1>
                
                <!-- æ–‡ç« å…ƒä¿¡æ¯ -->
                <div class="d-flex justify-content-between align-items-center mb-4 text-muted">
                    <div>
                        <span class="me-3">ğŸ‘¤ {{ post.author.username }}</span>
                        <span>ğŸ“… {{ post.created_at|date:"Yå¹´mæœˆdæ—¥ H:i" }}</span>
                        {% if post.category %}
                            <span class="me-3">ğŸ“‚ 
                                <a href="{% url 'blog:category_posts' post.category.slug %}" class="text-muted text-decoration-none">
                                    {{ post.category.name }}
                                </a>
                            </span>
                        {% endif %}
                        {% if post.tags.exists %}
                            <span>ğŸ·ï¸ 
                                {% for tag in post.tags.all %}
                                    <a href="{% url 'blog:tag_posts' tag.slug %}" class="badge bg-secondary text-decoration-none">
                                        {{ tag.name }}
                                    </a>
                                {% endfor %}
                            </span>
                        {% endif %}
                    </div>
                    {% if post.updated_at != post.created_at %}
                        <small>ğŸ”„ æ›´æ–°äº {{ post.updated_at|date:"Yå¹´mæœˆdæ—¥ H:i" }}</small>
                    {% endif %}
                </div>

                <!-- æ–‡ç« æ­£æ–‡ -->
                <div class="post-content">
                    {{ post.content|linebreaks }}
                </div>

                <!-- ç¤¾äº¤åˆ†äº«æŒ‰é’® -->
                <div class="mt-4 pt-3 border-top">
                    <h6 class="mb-3">ğŸ“¤ åˆ†äº«è¿™ç¯‡æ–‡ç« ï¼š</h6>
                    <div class="d-flex gap-2">
                        <a href="https://twitter.com/intent/tweet?text={{ post.title|urlencode }}&url={{ request.build_absolute_uri|urlencode }}" 
                           class="btn btn-outline-primary btn-sm" target="_blank" rel="noopener">
                            <i class="fab fa-twitter"></i> Twitter
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}" 
                           class="btn btn-outline-primary btn-sm" target="_blank" rel="noopener">
                            <i class="fab fa-facebook"></i> Facebook
                        </a>
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}" 
                           class="btn btn-outline-primary btn-sm" target="_blank" rel="noopener">
                            <i class="fab fa-linkedin"></i> LinkedIn
                        </a>
                        <button class="btn btn-outline-secondary btn-sm" onclick="copyToClipboard()">
                            <i class="fas fa-link"></i> å¤åˆ¶é“¾æ¥
                        </button>
                    </div>
                </div>
            </div>
        </article>

        <!-- æ–‡ç« å¯¼èˆª -->
        <div class="mt-4 d-flex justify-content-between">
            <div>
                {% if post.id > 1 %}
                    <a href="{% url 'blog:post_detail' post.id|add:'-1' %}" class="btn btn-outline-primary">
                        â† ä¸Šä¸€ç¯‡
                    </a>
                {% endif %}
            </div>
            <div>
                {% if is_last_post %}
                    <span class="btn btn-outline-secondary disabled">
                        å½“å‰å·²ç»æ˜¯æœ€åä¸€ç¯‡
                    </span>
                {% else %}
                    <a href="{% url 'blog:post_detail' post.id|add:'1' %}" class="btn btn-outline-primary">
                        ä¸‹ä¸€ç¯‡ â†’
                    </a>
                {% endif %}
            </div>
        </div>

        <!-- è¯„è®ºåŒºåŸŸ -->
        <div class="mt-5">
            <h3 class="mb-4">ğŸ’¬ è¯„è®º ({{ comments.count }})</h3>
            
            {% if comments %}
                <div class="comments-list mb-4">
                    {% for comment in comments %}
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-subtitle mb-1 text-primary">
                                        ğŸ‘¤ {{ comment.author.username }}
                                    </h6>
                                    <small class="text-muted">
                                        ğŸ“… {{ comment.created_at|date:"Yå¹´mæœˆdæ—¥ H:i" }}
                                    </small>
                                </div>
                                <p class="card-text">{{ comment.content|linebreaks }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    <p class="mb-0">æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼</p>
                </div>
            {% endif %}

            <!-- è¯„è®ºè¡¨å• -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">å‘è¡¨è¯„è®º</h5>
                </div>
                <div class="card-body">
                    {% if user.is_authenticated %}
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="comment" value="true">
                            
                            <div class="mb-3">
                                {{ comment_form.content.label_tag }}
                                {{ comment_form.content }}
                                {% if comment_form.content.errors %}
                                    <div class="text-danger">
                                        {{ comment_form.content.errors }}
                                    </div>
                                {% endif %}
                                <div class="form-text">
                                    æœ€å¤šå¯è¾“å…¥1000ä¸ªå­—ç¬¦
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> å‘è¡¨è¯„è®º
                            </button>
                        </form>
                    {% else %}
                        <div class="alert alert-warning">
                            <p class="mb-0">
                                ğŸ” è¯·å…ˆ <a href="{% url 'login' %}" class="alert-link">ç™»å½•</a> åå†å‘è¡¨è¯„è®º
                            </p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æ¶ˆæ¯æç¤º -->
{% if messages %}
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        {% for message in messages %}
            <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <strong class="me-auto">ç³»ç»Ÿæç¤º</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    {{ message }}
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}

<script>
function copyToClipboard() {
    const url = '{{ request.build_absolute_uri }}';
    navigator.clipboard.writeText(url).then(() => {
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        const toast = document.createElement('div');
        toast.className = 'toast show position-fixed bottom-0 end-0 m-3';
        toast.innerHTML = `
            <div class="toast-header bg-success text-white">
                <strong class="me-auto">æˆåŠŸ</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼
            </div>
        `;
        document.body.appendChild(toast);
        
        // 3ç§’åè‡ªåŠ¨ç§»é™¤æç¤º
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }).catch(err => {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥ï¼š' + url);
    });
}
</script>

{% endblock %}
